# CD - Supuesto 3: Publicacion de Versiones Oficiales (Releases)
# Se activa cuando se crea un tag que empieza por "v" (ej: v1.0.0, v2.1.3)
name: CD - Release Oficial

on:
  push:
    tags:
      - 'v*' # Solo se dispara con tags del tipo v1.0, v2.0.1, etc.

jobs:
  release:
    runs-on: ubuntu-latest

    permissions:
      contents: write # Permiso necesario para crear una Release en GitHub

    steps:
      # Paso 1: Descarga el codigo del tag concreto
      - name: Checkout del codigo
        uses: actions/checkout@v4

      # Paso 2: Configura Java 21
      - name: Configurar Java 21
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'
          cache: 'maven'

      # Paso 3: Genera el .war final listo para produccion
      - name: Generar ejecutable .war
        run: mvn -B clean package -DskipTests --file pom.xml

      # Paso 4: Crea la Release oficial en GitHub y adjunta el .war como binario
      - name: Crear Release Oficial en GitHub
        uses: softprops/action-gh-release@v2
        with:
          files: target/*.war # Adjunta el .war a la release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # Token automatico de GitHub
